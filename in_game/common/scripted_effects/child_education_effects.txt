# Select best education based on child's education modifiers
select_best_child_education_trait_based = {
	if = {
		limit = { has_child_education = expensive_in_depth_education }
		# Do nothing - keep expensive education forever
	}
	else = {
		# Save current modifiers
		save_temporary_scope_value_as = {
			name = curr_adm
			value = modifier:character_adm_child_education
		}
		save_temporary_scope_value_as = {
			name = curr_dip
			value = modifier:character_dip_child_education
		}
		save_temporary_scope_value_as = {
			name = curr_mil
			value = modifier:character_mil_child_education
		}
		
		# Compute base modifiers by removing current education bonuses
		if = {
			limit = { has_child_education = administrative_education }
			save_temporary_scope_value_as = { name = base_adm value = { value = scope:curr_adm subtract = 0.75 } }
			save_temporary_scope_value_as = { name = base_dip value = { value = scope:curr_dip subtract = 0.25 } }
			save_temporary_scope_value_as = { name = base_mil value = { value = scope:curr_mil subtract = 0.25 } }
		}
		else_if = {
			limit = { has_child_education = diplomatic_education }
			save_temporary_scope_value_as = { name = base_adm value = { value = scope:curr_adm subtract = 0.25 } }
			save_temporary_scope_value_as = { name = base_dip value = { value = scope:curr_dip subtract = 0.75 } }
			save_temporary_scope_value_as = { name = base_mil value = { value = scope:curr_mil subtract = 0.25 } }
		}
		else_if = {
			limit = { has_child_education = military_education }
			save_temporary_scope_value_as = { name = base_adm value = { value = scope:curr_adm subtract = 0.25 } }
			save_temporary_scope_value_as = { name = base_dip value = { value = scope:curr_dip subtract = 0.25 } }
			save_temporary_scope_value_as = { name = base_mil value = { value = scope:curr_mil subtract = 0.75 } }
		}
		else_if = {
			limit = { has_child_education = balanced_education }
			save_temporary_scope_value_as = { name = base_adm value = { value = scope:curr_adm subtract = 0.5 } }
			save_temporary_scope_value_as = { name = base_dip value = { value = scope:curr_dip subtract = 0.5 } }
			save_temporary_scope_value_as = { name = base_mil value = { value = scope:curr_mil subtract = 0.5 } }
		}
		else = {
			save_temporary_scope_value_as = { name = base_adm value = scope:curr_adm }
			save_temporary_scope_value_as = { name = base_dip value = scope:curr_dip }
			save_temporary_scope_value_as = { name = base_mil value = scope:curr_mil }
		}
		
		# 1. Specialists
		# Crown estate simplification: direct children of ruler only ever become ADM unless they are clear .5 specialists
		if = {
			#Child of heir
			limit = { is_child_of = owner.heir }
			set_child_education = child_education:administrative_education
		}
		else_if = {
			limit = {
				scope:base_adm > scope:base_dip
				scope:base_adm > scope:base_mil
			}
			set_child_education = child_education:administrative_education
		}
		else_if = {
			limit = {
				scope:base_dip > scope:base_adm
				scope:base_dip > scope:base_mil
			}
			set_child_education = child_education:diplomatic_education
		}
		else_if = {
			limit = {
				scope:base_mil > scope:base_adm
				scope:base_mil > scope:base_dip
			}
			set_child_education = child_education:military_education
		}
		# 2. Dual stats (ambitious, shrewd, gallant)
		else_if = {
			limit = {
				#Ambitious - 0.33 adm + 0.33 dip
				scope:base_adm > scope:base_mil
				scope:base_dip > scope:base_mil
				scope:base_adm = scope:base_dip
			}
			# Tie between ADM & DIP → choose Administrative (unique mapping per dual-stat trait)
			set_child_education = child_education:administrative_education
		}
		else_if = {
			limit = {
				#Shrewd - 0.33 adm + 0.33 mil
				scope:base_adm > scope:base_dip
				scope:base_mil > scope:base_dip
				scope:base_adm = scope:base_mil
			}
			set_child_education = child_education:military_education
		}
		else_if = {
			limit = {
				#Gallant - 0.33 dip + 0.33 mil
				scope:base_dip > scope:base_adm
				scope:base_mil > scope:base_adm
				scope:base_dip = scope:base_mil
			}
			# Tie between DIP & MIL → choose Diplomatic (unique mapping per dual-stat trait)
			set_child_education = child_education:diplomatic_education
		}
		# 3. Generalists
		else = {
			if = {
				limit = {
					scope:base_adm = scope:base_dip
					scope:base_adm = scope:base_mil
				}
				# All three equal → rotate evenly ADM → DIP → MIL (counter cycles: 0 → 1 → 2 → 0)
				owner = {
					# Initialize counter to 0 if it doesn't exist
					if = { 
						limit = { NOT = { has_variable = ace_generalist_counter } } 
						set_variable = { name = ace_generalist_counter value = 0 } 
					}
				}
				
				# Assign education based on counter value (0, 1, or 2)
				if = {
					limit = { owner = { check_variable = { name = ace_generalist_counter value = 0 } } }
					set_child_education = child_education:administrative_education
				}
				else_if = {
					limit = { owner = { check_variable = { name = ace_generalist_counter value = 1 } } }
					set_child_education = child_education:diplomatic_education
				}
				else_if = {
					limit = { owner = { check_variable = { name = ace_generalist_counter value = 2 } } }
					set_child_education = child_education:military_education
				}
				
				# Increment counter after assignment and wrap from 2 back to 0
				owner = {
					change_variable = { name = ace_generalist_counter add = 1 }
					if = { 
						limit = { check_variable = { name = ace_generalist_counter value = 3 } } 
						set_variable = { name = ace_generalist_counter value = 0 } 
					}
				}
			}
		}
	}
}

