# Auto Child Education v2.3 - Monthly pulse with "processed" marker
# Only processes children with revealed traits (age 3+)
# Children are marked once processed, so monthly checks get faster over time
# No birth hook needed - traits aren't revealed until age 3

monthly_country_pulse = {
	on_actions = {
		delay = { days = 1 }
		ace_monthly_check
	}
}

# Monthly check for unprocessed children only
ace_monthly_check = {
	effect = {
		# Only run for human players who have auto-education enabled
		if = {
			limit = { 
				is_ai = no 
				NOT = { has_variable = ace_disabled }
			}
			# Check all characters owned by this country
			every_character = {
				limit = {
					ace_should_auto_educate_child = yes
				}
				select_best_child_education_trait_based = yes
				# Mark as processed only if they have revealed traits
				if = {
					limit = { ace_has_child_trait = yes }
					set_variable = ace_processed
				}
			}
			# Also check dynasty members (children shown as dynasty)
			if = {
				limit = { has_ruler = yes }
				ruler = {
					if = {
						limit = { has_dynasty = yes }
						dynasty = {
							every_character_in_dynasty = {
								limit = {
									owner = root
									ace_should_auto_educate_child = yes
								}
								select_best_child_education_trait_based = yes
								# Mark as processed only if they have revealed traits
								if = {
									limit = { ace_has_child_trait = yes }
									set_variable = ace_processed
								}
							}
						}
					}
				}
			}
		}
	}
}
